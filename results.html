<template name="resultsPage">
  {{> search }}
  <div id="results">
    {{> results}}
  </div>
</template>
<template name="results">
  <script>
    $(document).on("gdriveready", function(e, driveApi){
      console.debug("Ready to query Google Drive files (results page)..");
      driveApi.files.list({
        q: "title contains '" + "surr" + "'"
      }).execute( updateUi );

      function updateUi(results){
        var docTitles = _.pluck(results.items, "title");
        Session.set("gdrive-results", docTitles);
        console.log(docTitles);
      }

      //@eigenhombre - is this the kind of thing you'd use a macro for?
      function reAuthWrap( callback, reAuthFn ){
        return function (response){
          if(response.error && response.error.code == 401){
            console.info("Your google session has expired, reauthenticating...");
            reAuthFn.call(null);
          }
          else if(response.error){
            console.error("Uknnown Google API error");
          } else {
            callback.call(response)
          }
        };
      }
    });
  </script>
  <div class="result">
    <div class="result-number">
      1
    </div>
    <div class="result-type-logo">
      <img src="/img/google-drive-logo.png" />
    </div>
    <div class="result-text-wrapper">
      <div class="result-title">
        <a target="_blank" href="https://docs.google.com/a/opinionlab.com/file/d/0B-0G9f-_CWvnODVfQ200V0MxRUU/edit">OpinionLab CRM Integration Process 2014.pdf</a>
      </div>
      <div class="result-subtitle">
        Subtitle?...preview of text? Date of item? Do we want information here?
      </div>
    </div>
  </div>
  <div class="result">
    <div class="result-number">
      2
    </div>
    <div class="result-type-logo">
      <img src="/img/salesforce-logo.jpg" />
    </div>
    <div class="result-text-wrapper">
      <div class="result-title">
        <a target="_blank" href="https://opinionlab.my.salesforce.com/5008000000XT378?srPos=0&srKp=500">DirectTV: Omniture Integration</a>
      </div>
      <div class="result-subtitle">
        Subtitle?...preview of text? Date of item? Do we want information here?
      </div>
    </div>
  </div>
  <div class="result result-border-bottom">
    <div class="result-number">
      3
    </div>
    <div class="result-type-logo">
      <img src="/img/questions-logo.jpg" />
    </div>
    <div class="result-text-wrapper">
      <div class="result-title">
        <a target="_blank" href="https://opinionlab.atlassian.net/wiki/questions/15695937/error-this-xml-file-does-not-appear-to-have-any-style-information-associated-with-it.-comment-cards">What is Tealeaf and how do we integrate?</a>
      </div>
      <div class="result-subtitle">
        Subtitle?...preview of text? Date of item? Do we want information here?
      </div>
    </div>
  </div>
</template>
